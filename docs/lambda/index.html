<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Lambda Service</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Plataforma 5 - Coding Bootcamp · Technical guide"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="## Investigación de lambdas aplicado a mailing (Santi)"><meta data-react-helmet="true" property="og:description" content="## Investigación de lambdas aplicado a mailing (Santi)"><meta data-react-helmet="true" property="og:url" content="https://P5devteam.github.io/docs/lambda">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.d6c9b6a4.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.ico" alt="Plataforma 5 - Coding Bootcamp"></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/P5devteam/docs">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.ico" alt="Plataforma 5 - Coding Bootcamp"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/P5devteam/docs">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">wow</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">aws</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/aws">AWS services</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/lambda">lambda</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/S3">S3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ECS">ECS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/RDS">RDS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">api</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dao">DAO</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Lambda Service</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="investigación-de-lambdas-aplicado-a-mailing-santi"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#investigación-de-lambdas-aplicado-a-mailing-santi" title="Direct link to heading">#</a>Investigación de lambdas aplicado a mailing (Santi)</h2><p>Bueno, acá les resumo un poco lo que hice con las Lambda de AWS para el servicio de mailing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="primer-aproach"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#primer-aproach" title="Direct link to heading">#</a>Primer aproach</h2><p>AWS te permite hacer todo &quot;manualmente&quot; desde la página. Ahí podes poner el nuevo código de la función, configurar el entorno de desarrollo, etc. Peeero a mi parecer, para el usuario inexperto, el flow de la página es confuso.
Para hacer el deploy de una lambda podes escribir el código en el editor de la página o subir un .zip. Hay un montón de blueprints que podes usar de AWS para no tener que escribir tanto. Si todo el código pesa más de 250 MB lo tenés que subir si o si a un S3 (con toda la config que eso implica). Además, una vez que lo subiste, tenes que agregar los triggers, es decir, cuando se va a llamar a la función. Estos pueden ser distintos eventos de servicios de AWS (p.e de un S3 o de dynamoDB) o HTTP.
Como lo que nosotros queremos son HTTP, hay que configurar los endpoints con distintas API gateways que apunten a la lambda.
Esto todavía no se como hacerlo directamente desde el sitio de AWS pero es lo que voy a investigar en estos dias.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="serverless-framework"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#serverless-framework" title="Direct link to heading">#</a>Serverless framework</h2><p>Por suerte encontre un framework que se llama &quot;serverless framework&quot; que ahorra muchos de los pasos manuales y te permite trabajar todo localmente, incluso hasta probar la función sin hacer el deploy. Una vez que está todo listo se corren unos comandos en la consola y el framework solito se encarga de hacer el deploy, subir el codigo a un S3 bucket y dejar las funciones ya escuchando. RE CHETO!
Con el framework ese es una pavada, incluso podés subir dependencias y librerías (mailgun en este caso) e ignora las devDependencies para el deploy.
Acá lo que hice:
Primero que nada cree en aws un nuevo usuario y un nuevo grupo con permisos de administrador (no es que hice una nueva cuenta, está dentro de p5) en la seccion IAM. Otro usuario que ya existía ahí es el de lumartex, por ejemplo. Creo que son como los roles de psql, ponele.
Bueno, entonces cree uno..
El Usuario se llama serverless-admin y el grupo serverless-group.
Despues instale aws-cli y serverless framework globalmente: npm i -g aws-cli serverless
Configure las credenciales de aws: te pide las claves y además una default region en la que usamos sa-east-1 y un default output format, ponemos json.
Despues configuramos serverless para aws:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sls config credentials --provider aws --key </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Access Key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --secret </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Secret Access Key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --profile </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Nombre del Usuario</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p><em>en la terminal los comandos de serverless se pueden poner comenzando con &quot;serverless&quot; o con &quot;sls&quot;, es lo mismo</em></p><p>Joya, ya está todo configurado. Ahora con un comando podemos crear un boilerplate de una lambda hecha en Nodejs:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sls create --template aws-nodejs</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Esto nos crea un <code>.gitignore</code>, un <code>handler.js</code> y un <code>serverless.yml</code>, Las ultimas dos son las unicas dos cosas indispensables para que funque.
En el handler va la funcion, y el el yml la config. Ahí mismo podes definir los endpoints y que función se le asigna a cada uno, está tremendo.
Para testear las cosas offline hay que instalar serverless-offline con el flag -D así despues es ignorado en el deploy.
Les explicaria más en detalle las configs pero son algunas cosas más y creo que es mejor si lo quieren saber que nos juntemos y lo veamos.
En fin, con el comando sls deploy (y hay algunos flags que te permiten elegir el staging, la región, etc) sale con fritas y ya queda funcionando en AWS. Con sls remove las bajas y chau.
Por ahora ya están funcionando las dos rutas que tiene la vieja api de mailing pero sin el pipedrive. Si bien funcionan flama hay algunas cosas que le preguntaría a juani en cuanto a la estructura de las lambdas:</p><ul><li><p>Conviene usar el serverless framework?</p></li><li><p>Así como está diagramado, se suben todos los node_modules y archivos dentro del root directory: ¿es mejor hacerlo con las layers que te provee aws o para un archivo tan liviano y simple no tiene sentido?</p></li><li><p>Son dos funciones, no hay ninguna estructura tipo controller&gt;&gt;&gt;model&gt;&gt;&gt;dao. Tiene sentido pq no hay ninguna DB involucrada todavía, pero llegado al caso, cuál es la idea: ¿Hago todo dentro del export de cada handler? ¿O divido y modularizo todo? Realmente no se que conviene con las lambda porque cuanto menor sea el runtime mejor, por lo menos económicamente hablando jajajaj</p><p>Ah, y bueno, acá están las rutas, las dos POST:
<a href="https://e4trp6her0.execute-api.us-east-1.amazonaws.com/dev/contacto">https://e4trp6her0.execute-api.us-east-1.amazonaws.com/dev/contacto</a>
<a href="https://e4trp6her0.execute-api.us-east-1.amazonaws.com/dev/aplicar">https://e4trp6her0.execute-api.us-east-1.amazonaws.com/dev/aplicar</a>
En el body tienen que tener si o si los campos consulta, nombre e email y la ruta de aplicar tambien el campo curso, que puede ser solamente intro o bootcamp en string.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="segundo-aproach"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#segundo-aproach" title="Direct link to heading">#</a>Segundo aproach</h2><p>Gueno, acá va un update de mis indagaciones en AWS-lambda.</p><p>Logré hacer lo mismo que les había comentado anteriormente con el serverless framework pero esta vez manualmente. Es bastante un quilombo entenderlo desde la documentación de AWS pero una vez que sale no es taaanto ni tan dificil.
No aprendí a usar la consola de AWS lambda pq son un montón de comandos y se puede hacer lo mismo con la interfaz gráfica.
De nuevo, si les pinta que les muestre como hacerlo nosju un ratito y lo vemos.
En fin, acá van algunos comentarios acerca de mis interacciones con la empresa de Jeff Bezos XD:</p><ul><li>Para hacer la función hay un editor online que está copado pq te deja crear carpetas y archivos y lo que quieras, funciona igual que si estuvieras en el editor de la compu. Si no se necesita trabajar con npm y la función es algo simple me parece una rápida y cómoda opción. Si hay que usar npm (o cualquier cosa para la que haya que correr comandos en una terminal) yo recomendaría trabajar todo localmente y después subirlo en un .zip, el resultado es realmente el mismo. Es más, aws lo descomprime sólo y te lo muestra en el editor que les decía!</li><li>Ahora, la cosa se complica un poco para agregar los triggers. Hay que aprender a usar API gateway (oooootro servicio más de aws) que te permite crear una API rest y asignarle una lambda a cada endpoint. Cada endpoint requiere un poco de configuración pero nada del otro mundo. Si habilitas la opción de que las requests pasen por un proxy que tiene aws por ahí dando vueltas te ahorrás un montón de trabajo en cuanto a configs. Sobre todo por que si no habría que configurar cada param de la URL (si es que la ruta los tiene) y ni hablar los query strings. Habilitando el proxy le llega todo &quot;parseado&quot; al event de la funcion y listo para ser usado.</li><li>Para incluir paquetes y demás, es como ya les había contado antes con el framework, ni un drama. El deploy de la lambda se hace por separado del de la API, osea, funcionan independientemente así que hay que asegurarse de que ambos estén funcionando en simultáneo.
Realmente no me pareció tan complicado una vez que encontré las partes juuustas en la documentación. Peeero también entiendo que hay un montón de herramientas y configuraciones que estoy dejando de lado. Con lo que aprendí, con o sin el serverless framework, se puede hacer el servicio de mailing muy tranquilamente.
De todos modos creo que hay varias cosas que estaría copado que juani nos las explique para optimizar la API y no consumir recursos al pedo.
También me queda pendiente hacer las cosas con typescript. Estaría bueno hacerlas, luego transpilarlo y subir eso.</li></ul><p><strong> SERVERLESS FRAMEWORK O NO? </strong></p><p>EL resultado después de hacer el deploy con el framework o subiendo un zip es EXACTAMENTE el mismo en cuanto a la estructura de la lambda, así que por ese lado no se consumen recursos adicionales. Ahora, una REEE ventaja que le encontré al framework es que ya directamente en el yml podés configurar los triggers y los endpoints. Osea, cuando hacés el deploy de la lambda con sls (serverless frmwrk) también se genera auntomáticamente una API con API gateway que encima usa el proxy de aws. En este sentido realmente se ahorra una buena cantidad de tiempo. Lo que no se es si de esta manera queda algo mal configurado o perdés algunas funcionalidades. Eso es lo que estaría bueno preguntarle a JUANI.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/lambda.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/aws"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« AWS services</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/S3"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Simple Storage Service (S3) »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#investigación-de-lambdas-aplicado-a-mailing-santi" class="contents__link">Investigación de lambdas aplicado a mailing (Santi)</a></li><li><a href="#primer-aproach" class="contents__link">Primer aproach</a></li><li><a href="#serverless-framework" class="contents__link">Serverless framework</a></li><li><a href="#segundo-aproach" class="contents__link">Segundo aproach</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Way of Work</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Style Guide</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://plataforma5.slack.com/messages">Slack</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://plataforma5.la">Landing</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Services</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://github.com/P5devteam" href="https://github.com/P5devteam">Github</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://aws.amazon.com">AWS</a></li></ul></div></div><div class="text--center">Copyright © 2020 Plataforma 5 - Coding Bootcamp, Built with Docusaurus.</div></div></footer>
</div>

<script src="/styles.abe581b4.js"></script>

<script src="/runtime~main.f7fd0e4e.js"></script>

<script src="/main.1bd56898.js"></script>

<script src="/1.fe77d716.js"></script>

<script src="/2.cc493b43.js"></script>

<script src="/1be78505.5544fb8a.js"></script>

<script src="/20ac7829.95f0b5e9.js"></script>

<script src="/17896441.f92c0e6b.js"></script>

<script src="/b1f5087c.5294fb90.js"></script>


</body>
</html>